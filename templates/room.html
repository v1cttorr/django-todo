{% extends 'base.html' %}

{% block content %}
    Room <br> <br>

    <form method="POST" id="addTask">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Title"> <br>
        <input type="text" name="description" placeholder="Description"> <br>
        <input type="datetime-local" name="date"> <br>
        <select name="importance" id="importance">
            <option value="trivial">Trivial</option>
            <option value="important">Important</option>
            <option value="high_priority">High Priority</option>
            <option value="very_important">Very Important</option>
        </select>
        <input type="submit" value="Add Task">
    </form>

    <script>
        //*************** SEND TASKS ***************
        $('#addTask').on('submit', function(e) {
            e.preventDefault();

            var title = $('input[name="title"]').val();
            var description = $('input[name="description"]').val();
            var date = $('input[name="date"]').val();
            var importance = $('#importance').val();
            console.log(title, description, date, importance);

            $.ajax({
                url: 'add-task/',
                type: 'POST',
                data: {
                    title: title,
                    description: description,
                    date: date,
                    importance: importance
                },
                headers: {
                    'X-CSRFToken': '{{csrf_token}}'
                },
                success: function(response) {
                    getTasks()
                }
            });
        });

        //*************** GET TASKS ***************
        function getTasks(){
            $.ajax({
                url: 'get-tasks/',
                type: 'GET',
                success: function(data) {
                    $('#tasks').html('');
                    data.tasks.forEach(function (data) {
                        $('#tasks').append('<h2>' + data.title + '</h2>');
                        $('#tasks').append('<h4>' + data.description + '</h4>');
                        $('#tasks').append('<h4>' + data.date + '</h4>');
                        $('#tasks').append('<h4>' + data.importance + '</h4>');
                        $('#tasks').append('<input type="checkbox" id="check' + data.id + '" >' + data.completed);
                        document.getElementById('check' + data.id).checked = data.completed;
                        $('#tasks').append('<hr>');
                    })
                }
            });
        } //TODO SAVE CHECKBOX STATE
        getTasks()
    </script>

    <br> <br>
    <div id="tasks"></div>

    <!-- {% for task in room.get_tasks %}
        {{task.title}} <br>
        {{task.description}} <br>
        {{task.completed}} <br>
        {{task.date}} <br>
        {{task.importance}} <br> <br> <br>
    {% endfor %} -->

{% endblock %}